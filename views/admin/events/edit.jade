include ../../mixins/addressSelector
include ../../mixins/personSelector
include ../../mixins/scheduleDatesSelector
include ../scheduleDates/parts/form
include ../includes/formActionButtons

extend ../layout

append javascripts
    script(src="/javascripts/scheduleDayForm.js")
    script.
        $(function(){
            scheduleEventFormScripts('#{data.id}', '#{data.id}')
            var validationRules = {
                eventName : ['empty'],
                description: ['empty'],
                mainPerson: ['empty'],
                schedules: ['empty'],
                location: ['empty']
            }

            var $form =  $('form[name=mainForm]')

            // CREATE / SAVE
            $form.form({
                fields: validationRules,
                inline : false,
                onSuccess: function(event, fields){
                    $.ajax({
                        type: '#{formMethod}',
                        data: fields,
                        url: '#{apiItem}',
                        dataType: 'JSON',
                        statusCode: {
                            201: function() {
                                console.log('201 Error')
                                $.get('/message/success/Saved successfully')
                            },
                            501: function() {
                                console.log('501 Error')
                                $.get('/message/error/Error saving')
                            }
                        }
                    })
                    .done(function(response) {
                        location.replace('#{editAction}' + response.data.id)
                    })
                    return false
                }
            })

            $('.ui.delete.modal').modal({
                onApprove: function(){
                    $.ajax({
                        type: 'delete',
                        data:  $form.form('get values'),
                        url: '#{apiItem}#{data.id}',
                        dataType: 'JSON',
                        statusCode: {
                            204: function() {
                                $.get('/message/success/Deleted successfully')
                            },
                            501: function() {
                                $.get('/message/error/Error deleting')
                            }
                        }
                    })
                    .done(function(response) {
                        location.replace('#{listAction}')
                    })
                }
            })
            $form.find('.delete.button').click(function(){
                $('.ui.delete.modal').modal('show')
            })
            $form.find('#addSchedules').click(function(){
                $('#schedulesForm').modal('show')
            })
            $form.find('.personSelector').search(localPersonSearch)
            $form.find('.addressSelector').search(localAddressSearch)
        })

append appContent

    h1 Event

    form.ui.form(name='mainForm')

        input(type="hidden", name="id", value=data.id)

        div(style='display: none;')
            input#PreventChromeAutocomplete(type='text', name='PreventChromeAutocomplete', autocomplete='address-level4')

        .ui.raised.segment

            if (formMethod != 'post' && formMethod != 'get')
                input(type='hidden', name='_method', value=formMethod)

            .field.required
                label(for="eventName") Event Name
                input(type="text", name="name", id="eventName", value=data.name)

            .field.required
                label(for="description") Description
                textarea(type="text", name="description", id="description", rows="4")= data.description

        .ui.raised.segment

            .field.required
                label(for="location") Location
                +addressSelector("location", data._address, data.id)

        .ui.raised.segment

            .field.required
                label(for='mainPerson') Main Contact
                +personSelector('mainPerson', data._mainPerson?data._mainPerson.id:'', data._mainPerson?data._mainPerson.fullName:'')

        .ui.raised.segment

            .ui.row
                a#addSchedules.ui.right.floated.button(href='#')
                    i.icon.plus
                    | Add Schedule Day

                .field.required
                    label.ui.right.floated(for="schedules") Schedule Days

            #schedules.ui.relaxed.divided.list
                .item
                    i.large.clock.middle.aligned.icon
                    .content
                        a.header Jan 12th
                        .description 11:00am - 12:00am
                .item
                    i.large.clock.middle.aligned.icon
                    .content
                        a.header Jan 12th
                        .description 11:00am - 12:00am
                .item
                    i.large.clock.middle.aligned.icon
                    .content
                        a.header Jan 12th
                        .description 11:00am - 12:00am

        .ui.row
            +actionButtons(formMode)

        .ui.hidden.clearing.divider

        .ui.error.message


append footer
    //- Modal
    #schedulesForm.ui.modal
        .header Schedule Date
        .content

            form#editEvent.ui.form(method=formMethod action=formAction)

                div(style='display: none;')
                    input#PreventChromeAutocomplete(type='text', name='PreventChromeAutocomplete', autocomplete='address-level4')

                - if (formMethod != 'post' && formMethod != 'get')
                    input(type='hidden', name='_method', value=formMethod)

                +scheduleDayDateTime(data)

                +locationSelector(data)

        .actions
            .ui.cancel.button
                | Cancel
            .ui.primary.submit.button
                | Save